import { Suspense } from "react";
import { Metadata } from "next";
import Link from "next/link";
import { notFound } from "next/navigation";
import { ArrowLeftIcon } from "lucide-react";

import { buttonVariants } from "@workspace/ui/components/button";
import { Separator } from "@workspace/ui/components/separator";
import { generateMetadata as generateSEOMetadata } from "@workspace/ui/lib/seo";

import { source } from "@/lib/source";

import { Divider } from "@/components/divider";
import { mdxComponents } from "@/components/mdx";

export async function generateMetadata({
  params,
}: {
  params: Promise<{ slug: string[] }>;
}): Promise<Metadata> {
  const { slug } = await params;
  const page = source.getPage(slug);

  if (!page) {
    return {};
  }

  const doc = page.data;
  const url = `/${slug.join("/")}`;

  return generateSEOMetadata({
    title: doc.title,
    description: doc.description || `Read ${doc.title} on Template`,
    url,
    image: doc.thumbnail,
  });
}

async function PostsPage({ params }: { params: Promise<{ slug: string[] }> }) {
  const { slug } = await params;

  const page = source.getPage(slug);

  if (!page) {
    return notFound();
  }

  // Type assertion to help TypeScript understand the page structure
  const doc = page.data;
  const MDX = doc.body;

  if (slug.includes("client")) {
    return (
      <div className="mx-auto min-h-screen max-w-2xl px-8 py-24">
        <header className="mx-auto mb-8 flex flex-col items-center">
          <Divider />
          <svg
            viewBox="0 0 172 44"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="my-4 w-[200px]"
          >
            <path
              d="M49.6782 22.5194C49.6782 21.0628 49.9746 19.7926 50.5674 18.7086C51.1602 17.6077 51.9816 16.7609 53.0317 16.1681C54.0818 15.5584 55.2843 15.2535 56.6393 15.2535C58.3837 15.2535 59.8234 15.6939 60.9581 16.5746C62.1098 17.4383 62.8805 18.6578 63.27 20.2329H59.4338C59.2306 19.6232 58.8834 19.149 58.3922 18.8102C57.918 18.4546 57.3252 18.2767 56.6138 18.2767C55.5976 18.2767 54.7931 18.6493 54.2003 19.3945C53.6076 20.1228 53.3112 21.1644 53.3112 22.5194C53.3112 23.8574 53.6076 24.899 54.2003 25.6442C54.7931 26.3725 55.5976 26.7367 56.6138 26.7367C58.0535 26.7367 58.9935 26.0931 59.4338 24.8059H63.27C62.8805 26.3302 62.1098 27.5412 60.9581 28.4388C59.8064 29.3365 58.3668 29.7853 56.6393 29.7853C55.2843 29.7853 54.0818 29.4889 53.0317 28.8961C51.9816 28.2864 51.1602 27.4395 50.5674 26.3556C49.9746 25.2547 49.6782 23.976 49.6782 22.5194ZM68.9243 17.667C69.3816 16.9218 69.9744 16.3375 70.7026 15.914C71.4479 15.4906 72.2947 15.2789 73.2432 15.2789V19.0135H72.3032C71.1853 19.0135 70.3385 19.276 69.7626 19.801C69.2037 20.3261 68.9243 21.2407 68.9243 22.5448V29.5566H65.3675V15.4821H68.9243V17.667ZM81.3804 29.7853C80.0254 29.7853 78.806 29.4889 77.722 28.8961C76.6381 28.2864 75.7828 27.4311 75.1561 26.3302C74.5464 25.2293 74.2415 23.959 74.2415 22.5194C74.2415 21.0798 74.5548 19.8095 75.1815 18.7086C75.8251 17.6077 76.6973 16.7609 77.7982 16.1681C78.8991 15.5584 80.127 15.2535 81.482 15.2535C82.8369 15.2535 84.0649 15.5584 85.1658 16.1681C86.2666 16.7609 87.1304 17.6077 87.7571 18.7086C88.4007 19.8095 88.7225 21.0798 88.7225 22.5194C88.7225 23.959 88.3922 25.2293 87.7317 26.3302C87.0881 27.4311 86.2074 28.2864 85.0895 28.8961C83.9886 29.4889 82.7523 29.7853 81.3804 29.7853ZM81.3804 26.6858C82.024 26.6858 82.6252 26.5334 83.1841 26.2286C83.76 25.9068 84.2173 25.4325 84.556 24.8059C84.8948 24.1792 85.0641 23.417 85.0641 22.5194C85.0641 21.1814 84.7085 20.1567 83.9971 19.4454C83.3027 18.7171 82.4474 18.3529 81.4312 18.3529C80.415 18.3529 79.5597 18.7171 78.8653 19.4454C78.1878 20.1567 77.849 21.1814 77.849 22.5194C77.849 23.8574 78.1793 24.8905 78.8399 25.6188C79.5173 26.3302 80.3642 26.6858 81.3804 26.6858ZM96.2093 29.7853C95.0576 29.7853 94.0244 29.582 93.1098 29.1756C92.1953 28.7521 91.467 28.1848 90.925 27.4734C90.4 26.7621 90.112 25.9745 90.0612 25.1107H93.6434C93.7111 25.6527 93.9736 26.1015 94.4309 26.4572C94.9052 26.8129 95.4895 26.9907 96.1839 26.9907C96.8614 26.9907 97.3864 26.8552 97.759 26.5842C98.1486 26.3132 98.3433 25.966 98.3433 25.5426C98.3433 25.0853 98.1062 24.7466 97.632 24.5264C97.1747 24.2893 96.4379 24.0352 95.4217 23.7642C94.3716 23.5102 93.5079 23.2477 92.8304 22.9767C92.1699 22.7057 91.594 22.2907 91.1028 21.7318C90.6286 21.1729 90.3915 20.4192 90.3915 19.4708C90.3915 18.6917 90.6117 17.9803 91.052 17.3367C91.5093 16.6931 92.1529 16.185 92.9828 15.8124C93.8297 15.4398 94.8205 15.2535 95.9552 15.2535C97.632 15.2535 98.97 15.6769 99.9693 16.5238C100.969 17.3537 101.519 18.48 101.621 19.9027H98.2163C98.1655 19.3437 97.9284 18.9034 97.505 18.5816C97.0985 18.2428 96.548 18.0735 95.8536 18.0735C95.21 18.0735 94.7104 18.192 94.3547 18.4291C94.016 18.6663 93.8466 18.9965 93.8466 19.42C93.8466 19.8942 94.0837 20.2583 94.5579 20.5124C95.0322 20.7495 95.7689 20.9951 96.7682 21.2491C97.7844 21.5032 98.6228 21.7657 99.2833 22.0367C99.9439 22.3077 100.511 22.7311 100.985 23.307C101.477 23.8659 101.731 24.6111 101.748 25.5426C101.748 26.3556 101.519 27.0839 101.062 27.7275C100.621 28.3711 99.9777 28.8792 99.1309 29.2518C98.301 29.6075 97.3271 29.7853 96.2093 29.7853ZM109.545 29.7853C108.393 29.7853 107.36 29.582 106.446 29.1756C105.531 28.7521 104.803 28.1848 104.261 27.4734C103.736 26.7621 103.448 25.9745 103.397 25.1107H106.979C107.047 25.6527 107.309 26.1015 107.767 26.4572C108.241 26.8129 108.825 26.9907 109.52 26.9907C110.197 26.9907 110.722 26.8552 111.095 26.5842C111.484 26.3132 111.679 25.966 111.679 25.5426C111.679 25.0853 111.442 24.7466 110.968 24.5264C110.51 24.2893 109.774 24.0352 108.757 23.7642C107.707 23.5102 106.844 23.2477 106.166 22.9767C105.506 22.7057 104.93 22.2907 104.439 21.7318C103.964 21.1729 103.727 20.4192 103.727 19.4708C103.727 18.6917 103.947 17.9803 104.388 17.3367C104.845 16.6931 105.489 16.185 106.319 15.8124C107.165 15.4398 108.156 15.2535 109.291 15.2535C110.968 15.2535 112.306 15.6769 113.305 16.5238C114.304 17.3537 114.855 18.48 114.956 19.9027H111.552C111.501 19.3437 111.264 18.9034 110.841 18.5816C110.434 18.2428 109.884 18.0735 109.189 18.0735C108.546 18.0735 108.046 18.192 107.69 18.4291C107.352 18.6663 107.182 18.9965 107.182 19.42C107.182 19.8942 107.419 20.2583 107.894 20.5124C108.368 20.7495 109.105 20.9951 110.104 21.2491C111.12 21.5032 111.959 21.7657 112.619 22.0367C113.28 22.3077 113.847 22.7311 114.321 23.307C114.812 23.8659 115.066 24.6111 115.083 25.5426C115.083 26.3556 114.855 27.0839 114.397 27.7275C113.957 28.3711 113.313 28.8792 112.467 29.2518C111.637 29.6075 110.663 29.7853 109.545 29.7853ZM121.052 17.5146C121.509 16.871 122.136 16.3375 122.932 15.914C123.745 15.4737 124.668 15.2535 125.701 15.2535C126.903 15.2535 127.987 15.5499 128.953 16.1427C129.935 16.7355 130.706 17.5823 131.265 18.6832C131.84 19.7672 132.128 21.029 132.128 22.4686C132.128 23.9082 131.84 25.1869 131.265 26.3048C130.706 27.4057 129.935 28.261 128.953 28.8707C127.987 29.4804 126.903 29.7853 125.701 29.7853C124.668 29.7853 123.753 29.5736 122.957 29.1502C122.178 28.7267 121.543 28.1932 121.052 27.5496V36.2636H117.495V15.4821H121.052V17.5146ZM128.495 22.4686C128.495 21.6217 128.318 20.8935 127.962 20.2837C127.623 19.6571 127.166 19.1828 126.59 18.861C126.031 18.5392 125.421 18.3783 124.761 18.3783C124.117 18.3783 123.507 18.5477 122.932 18.8864C122.373 19.2082 121.915 19.6825 121.56 20.3091C121.221 20.9358 121.052 21.6726 121.052 22.5194C121.052 23.3662 121.221 24.103 121.56 24.7296C121.915 25.3563 122.373 25.839 122.932 26.1777C123.507 26.4995 124.117 26.6604 124.761 26.6604C125.421 26.6604 126.031 26.4911 126.59 26.1523C127.166 25.8136 127.623 25.3309 127.962 24.7042C128.318 24.0776 128.495 23.3324 128.495 22.4686ZM140.454 29.7853C139.1 29.7853 137.88 29.4889 136.796 28.8961C135.712 28.2864 134.857 27.4311 134.23 26.3302C133.62 25.2293 133.316 23.959 133.316 22.5194C133.316 21.0798 133.629 19.8095 134.256 18.7086C134.899 17.6077 135.771 16.7609 136.872 16.1681C137.973 15.5584 139.201 15.2535 140.556 15.2535C141.911 15.2535 143.139 15.5584 144.24 16.1681C145.341 16.7609 146.205 17.6077 146.831 18.7086C147.475 19.8095 147.797 21.0798 147.797 22.5194C147.797 23.959 147.466 25.2293 146.806 26.3302C146.162 27.4311 145.281 28.2864 144.164 28.8961C143.063 29.4889 141.826 29.7853 140.454 29.7853ZM140.454 26.6858C141.098 26.6858 141.699 26.5334 142.258 26.2286C142.834 25.9068 143.291 25.4325 143.63 24.8059C143.969 24.1792 144.138 23.417 144.138 22.5194C144.138 21.1814 143.783 20.1567 143.071 19.4454C142.377 18.7171 141.522 18.3529 140.505 18.3529C139.489 18.3529 138.634 18.7171 137.939 19.4454C137.262 20.1567 136.923 21.1814 136.923 22.5194C136.923 23.8574 137.253 24.8905 137.914 25.6188C138.591 26.3302 139.438 26.6858 140.454 26.6858ZM155.283 29.7853C154.132 29.7853 153.099 29.582 152.184 29.1756C151.269 28.7521 150.541 28.1848 149.999 27.4734C149.474 26.7621 149.186 25.9745 149.135 25.1107H152.717C152.785 25.6527 153.048 26.1015 153.505 26.4572C153.979 26.8129 154.564 26.9907 155.258 26.9907C155.935 26.9907 156.461 26.8552 156.833 26.5842C157.223 26.3132 157.417 25.966 157.417 25.5426C157.417 25.0853 157.18 24.7466 156.706 24.5264C156.249 24.2893 155.512 24.0352 154.496 23.7642C153.446 23.5102 152.582 23.2477 151.904 22.9767C151.244 22.7057 150.668 22.2907 150.177 21.7318C149.703 21.1729 149.466 20.4192 149.466 19.4708C149.466 18.6917 149.686 17.9803 150.126 17.3367C150.583 16.6931 151.227 16.185 152.057 15.8124C152.904 15.4398 153.895 15.2535 155.029 15.2535C156.706 15.2535 158.044 15.6769 159.043 16.5238C160.043 17.3537 160.593 18.48 160.695 19.9027H157.29C157.24 19.3437 157.002 18.9034 156.579 18.5816C156.173 18.2428 155.622 18.0735 154.928 18.0735C154.284 18.0735 153.784 18.192 153.429 18.4291C153.09 18.6663 152.921 18.9965 152.921 19.42C152.921 19.8942 153.158 20.2583 153.632 20.5124C154.106 20.7495 154.843 20.9951 155.842 21.2491C156.859 21.5032 157.697 21.7657 158.357 22.0367C159.018 22.3077 159.585 22.7311 160.06 23.307C160.551 23.8659 160.805 24.6111 160.822 25.5426C160.822 26.3556 160.593 27.0839 160.136 27.7275C159.695 28.3711 159.052 28.8792 158.205 29.2518C157.375 29.6075 156.401 29.7853 155.283 29.7853ZM167.374 18.4037V25.2123C167.374 25.6866 167.484 26.0338 167.705 26.254C167.942 26.4572 168.331 26.5588 168.873 26.5588H170.525V29.5566H168.289C165.291 29.5566 163.792 28.1001 163.792 25.1869V18.4037H162.115V15.4821H163.792V12.0016H167.374V15.4821H170.525V18.4037H167.374Z"
              fill="currentColor"
            />
            <path
              d="M35.8727 17.3093C39.4727 19.3877 39.4727 24.5839 35.8727 26.6623L19.094 36.3495C15.494 38.428 10.994 35.8299 10.994 31.673L10.994 12.2986C10.994 8.14168 15.494 5.54361 19.094 7.62207L35.8727 17.3093Z"
              fill="currentColor"
            />
          </svg>
          <Divider />
          <div className="my-4 flex flex-col items-center">
            <p className="text-muted-foreground text-center font-semibold md:text-lg">
              Crosspost is a platform that allows you to cross-post your content
              to multiple platforms.
            </p>
            <Link
              href={"https://www.crosspost.app/"}
              target="_blank"
              className={buttonVariants({ className: "mt-4" })}
            >
              Visit
            </Link>
          </div>
          <Divider />
        </header>
        <MDX components={mdxComponents} />
      </div>
    );
  }

  return (
    <div className="px-4">
      <div className="mx-auto max-w-2xl py-24">
        <Link
          href="/"
          className={buttonVariants({
            variant: "ghost",
            className: "mb-8 -translate-x-4",
          })}
        >
          <ArrowLeftIcon /> Back
        </Link>
        <div className="flex flex-col gap-4">
          <h1 className="text-3xl font-bold md:text-5xl">{doc.title}</h1>
          {doc.description && (
            <p className="text-muted-foreground text-sm">{doc.description}</p>
          )}
          {doc.thumbnail && (
            <img
              src={doc.thumbnail}
              alt={doc.title ?? ""}
              className="aspect-video w-full rounded-xl object-cover"
            />
          )}
        </div>
        <Separator className="my-8" />
        <MDX components={mdxComponents} />
      </div>
    </div>
  );
}

const Page = ({ params }: { params: Promise<{ slug: string[] }> }) => {
  return (
    <Suspense>
      <PostsPage params={params} />
    </Suspense>
  );
};

export default Page;
